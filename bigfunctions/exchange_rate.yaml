type: function_py
category: get_data
author:
  name: Johan PROTIN
  url: https://www.linkedin.com/in/johan-protin
  avatar_url: "https://media.licdn.com/dms/image/C4E03AQH1sYz9Zik0TQ/profile-displayphoto-shrink_800_800/0/1653692064309?e=1688601600&v=beta&t=c6DsEpUE-cC_zdW5vTrfyyBgiTJLeBGg5oUlzJmsnKw"
description: |
  Get `exchange_rate`
  from `base` (e.g. `USD`) to `to` (e.g. `EUR`)
  *using [https://theforexapi.com/](https://theforexapi.com/)*

  | Param  | Possible values  |
  |---|---|
  | `base`<br>and<br>`to`  | `EUR`, `USD`, `JPY`, `BGN`, `CZK`, `DKK`, `GBP`, `HUF`, `PLN`, `RON`, `SEK`, `CHF`, `ISK`, `NOK`, `TRY`, `AUD`, `BRL`, `CAD`, `CNY`, `HKD`, `IDR`, `INR`, `KRW`, `MXN`, `MYR`, `NZD`, `PHP`, `SGD`, `THB`, `ZAR` |
arguments:
  - name: base
    type: string
  - name: to
    type: string
output:
  name: exchange_rate
  type: float64
examples:
  - description: "To know how many euros a dollar is worth"
    arguments:
      - "'USD'"
      - "'EUR'"
    output: "0.910437"
code: |
  import requests
  import datetime

  if base == to:
    return 1

  accepted_values = ["EUR", "USD", "JPY", "BGN", "CZK", "DKK", "GBP", "HUF", "PLN", "RON", "SEK", "CHF", "ISK", "NOK", "TRY", "AUD", "BRL", "CAD", "CNY", "HKD", "IDR", "INR", "KRW", "MXN", "MYR", "NZD", "PHP", "SGD", "THB", "ZAR"]
  assert base in accepted_values, f'First argument `base` is `{base}` BUT must be among {accepted_values}'
  assert to in accepted_values, f'Second argument `to` is `{to}` BUT must be among {accepted_values}'

  today = datetime.datetime.utcnow().strftime("%Y-%m-%d")
  if today not in CACHE:
    url = 'https://theforexapi.com/api/latest'
    response = requests.get(url)
    data = response.json()
    rates = data['rates']
    rates['EUR'] = 1
    CACHE[today] = rates

  rates = CACHE[today]
  return rates[to] / rates[base]
requirements: |
  requests
