declare date1, date2 date;
declare country string;
declare weekend_days array<string>;

set date1 = current_date - 90;
set date2 = current_date;
set country = 'FR';
set weekend_days = ['SATURDAY', 'SUNDAY'];


with dates as (
  select
    date,
    format_date('%A', date) as formatted_date,
    bigfunctions.eu.is_public_holiday(date, country) as is_public_holiday,
    upper(format_date('%A', date)) in (select * from unnest(weekend_days)) as is_weekend,
  from unnest(generate_date_array(date1, date2)) date
)

select countif(not is_public_holiday and not is_weekend)
from dates